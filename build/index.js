(()=>{"use strict";const e=window.wp.element,s=window.React,i=window.ReactJSXRuntime,a=({activeView:e,onChangeView:s})=>(0,i.jsx)("div",{className:"wcso-sidebar",children:(0,i.jsx)("ul",{children:[{id:"create_order",label:"Create Order",icon:"dashicons-cart"},{id:"settings",label:"Settings",icon:"dashicons-admin-settings"},{id:"analytics",label:"Analytics",icon:"dashicons-chart-bar"}].map(a=>(0,i.jsxs)("li",{className:e===a.id?"active":"",onClick:()=>s(a.id),children:[(0,i.jsx)("span",{className:`dashicons ${a.icon}`}),a.label]},a.id))})}),n=({onAddProduct:e})=>{const[a,n]=(0,s.useState)(""),[t,r]=(0,s.useState)([]),[c,o]=(0,s.useState)(!1);(0,s.useEffect)(()=>{const e=setTimeout(()=>{a.length>2?l(a):r([])},500);return()=>clearTimeout(e)},[a]);const l=e=>{o(!0),window.jQuery.ajax({url:window.wcsoData.ajaxUrl,type:"POST",data:{action:"wcso_search_products",search:e,nonce:window.wcsoData.searchNonce},success:e=>{o(!1),e.success?r(e.data):console.log("Search error:",e)},error:e=>{o(!1),console.log("AJAX error:",e)}})};return(0,i.jsxs)("div",{className:"wcso-search-box",children:[(0,i.jsxs)("h3",{children:[(0,i.jsx)("span",{className:"dashicons dashicons-search"})," Add Products"]}),(0,i.jsxs)("div",{className:"wcso-search-input-wrapper",children:[(0,i.jsx)("input",{type:"text",placeholder:"Search by Name or SKU...",value:a,onChange:e=>n(e.target.value),className:"wcso-input-large"}),c&&(0,i.jsx)("span",{className:"spinner is-active",style:{float:"none",margin:"10px"}})]}),t.length>0&&(0,i.jsx)("div",{className:"wcso-search-results",children:t.map(s=>(0,i.jsxs)("div",{className:"wcso-result-item",onClick:()=>{e(s),n(""),r([])},children:[(0,i.jsx)("strong",{children:s.name}),(0,i.jsx)("span",{className:`wcso-badge status-${s.status}`,children:s.status}),(0,i.jsx)("div",{className:"wcso-price",children:s.price_html})]},s.id))})]})},t=({cart:e,onUpdateQty:s,onRemove:a})=>{const n=e.reduce((e,s)=>e+parseFloat(s.price)*s.quantity,0);return(0,i.jsxs)("div",{className:"wcso-cart-wrapper",children:[(0,i.jsxs)("h3",{children:[(0,i.jsx)("span",{className:"dashicons dashicons-cart"})," Selected Items (",e.length,")"]}),0===e.length?(0,i.jsx)("div",{className:"wcso-empty-cart",children:(0,i.jsx)("p",{children:"No products selected yet."})}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("table",{className:"wcso-table",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{children:"Product"}),(0,i.jsx)("th",{children:"Price"}),(0,i.jsx)("th",{children:"Qty"}),(0,i.jsx)("th",{children:"Total"}),(0,i.jsx)("th",{})]})}),(0,i.jsx)("tbody",{children:e.map(e=>(0,i.jsxs)("tr",{children:[(0,i.jsxs)("td",{children:[(0,i.jsx)("strong",{children:e.name}),(0,i.jsx)("br",{}),(0,i.jsxs)("small",{className:"wcso-sku",children:["SKU: ",e.sku]})]}),(0,i.jsx)("td",{children:e.price}),(0,i.jsx)("td",{children:(0,i.jsx)("input",{type:"number",min:"1",value:e.quantity,onChange:i=>s(e.id,parseInt(i.target.value)),className:"wcso-qty-input"})}),(0,i.jsx)("td",{children:(e.price*e.quantity).toFixed(2)}),(0,i.jsx)("td",{children:(0,i.jsx)("button",{className:"wcso-remove-btn",onClick:()=>a(e.id),children:"×"})})]},e.id))})]}),(0,i.jsxs)("div",{className:"wcso-cart-total",children:[(0,i.jsx)("span",{children:"Original Total:"}),(0,i.jsx)("strong",{children:n.toFixed(2)})]})]})]})},r=({cartTotal:e})=>{const s=window.wcsoData.tierConfig;let a={msg:"",color:"",icon:""};return a=e<=0?{msg:"Add products to calculate tier...",color:"grey",icon:"dashicons-minus"}:e<=15?{msg:`Auto-Approved (${s.t1.name})`,color:"#46b450",icon:"dashicons-yes-alt"}:e<=100?{msg:`Approval Needed: ${s.t2.name}`,color:"#f0b849",icon:"dashicons-warning"}:{msg:`Approval Needed: ${s.t3.name}`,color:"#d63638",icon:"dashicons-shield"},(0,i.jsxs)("div",{className:"wcso-tier-box",style:{borderLeftColor:a.color},children:[(0,i.jsx)("span",{className:`dashicons ${a.icon}`,style:{color:a.color}}),(0,i.jsx)("span",{className:"wcso-tier-text",children:a.msg})]})},c=({formData:e,setFormData:a})=>{const{countries:n,states:t,shippingZones:r,users:c}=window.wcsoData,[o,l]=(0,s.useState)({}),[d,p]=(0,s.useState)([]);(0,s.useEffect)(()=>{const s=e.shipping_country;t[s]?l(t[s]):l({})},[e.shipping_country,t]),(0,s.useEffect)(()=>{let s=null;for(let i of r){for(let a of i.zone_locations)if("country"===a.type&&a.code===e.shipping_country){s=i;break}if(s)break}const i=s?s.shipping_methods:[];if(p(i),i.length>0){const e=i[0];a(s=>({...s,shipping_method:e.method_id,shipping_method_id:e.method_id,shipping_method_title:e.instance_title,shipping_method_cost:e.instance_cost,shipping_method_instance_id:e.instance_id}))}else a(e=>({...e,shipping_method:"",shipping_method_id:"",shipping_method_title:"",shipping_method_cost:"",shipping_method_instance_id:""}))},[e.shipping_country,r,a]);const h=e=>{const{name:s,value:i}=e.target;a(e=>({...e,[s]:i}))};return(0,i.jsxs)("div",{className:"wcso-form-wrapper",children:[(0,i.jsxs)("h3",{className:"wcso-section-header",children:[(0,i.jsx)("span",{className:"dashicons dashicons-admin-users"})," Billing Information"]}),(0,i.jsxs)("div",{className:"wcso-form-group",children:[(0,i.jsx)("label",{children:"Billed To (Sales Rep / Employee)"}),(0,i.jsx)("select",{name:"billing_user_id",value:e.billing_user_id,onChange:h,className:"wcso-input",style:{fontWeight:"bold"},children:c.map(e=>(0,i.jsxs)("option",{value:e.ID,children:[e.display_name," (",e.user_email,")"]},e.ID))}),(0,i.jsx)("p",{className:"description",style:{marginTop:"5px",color:"#666",fontSize:"12px"},children:"Defaults to current user."})]}),(0,i.jsx)("hr",{className:"wcso-divider",style:{margin:"25px 0",border:"0",borderTop:"1px solid #eee"}}),(0,i.jsxs)("h3",{className:"wcso-section-header",children:[(0,i.jsx)("span",{className:"dashicons dashicons-location"})," Shipping Information"]}),(0,i.jsxs)("div",{className:"wcso-grid-2",children:[(0,i.jsxs)("div",{className:"wcso-form-group",children:[(0,i.jsxs)("label",{children:["First Name ",(0,i.jsx)("span",{className:"wcso-required",children:"*"})]}),(0,i.jsx)("input",{type:"text",name:"shipping_first_name",value:e.shipping_first_name,onChange:h,className:"wcso-input"})]}),(0,i.jsxs)("div",{className:"wcso-form-group",children:[(0,i.jsxs)("label",{children:["Last Name ",(0,i.jsx)("span",{className:"wcso-required",children:"*"})]}),(0,i.jsx)("input",{type:"text",name:"shipping_last_name",value:e.shipping_last_name,onChange:h,className:"wcso-input"})]})]}),(0,i.jsxs)("div",{className:"wcso-form-group",children:[(0,i.jsx)("label",{children:"Company (optional)"}),(0,i.jsx)("input",{type:"text",name:"shipping_company",value:e.shipping_company,onChange:h,className:"wcso-input"})]}),(0,i.jsxs)("div",{className:"wcso-form-group",children:[(0,i.jsxs)("label",{children:["Country / Region ",(0,i.jsx)("span",{className:"wcso-required",children:"*"})]}),(0,i.jsxs)("select",{name:"shipping_country",value:e.shipping_country,onChange:h,className:"wcso-input",children:[(0,i.jsx)("option",{value:"",children:"Select Country..."}),Object.entries(n).map(([e,s])=>(0,i.jsx)("option",{value:e,children:s},e))]})]}),(0,i.jsxs)("div",{className:"wcso-form-group",children:[(0,i.jsxs)("label",{children:["Street address ",(0,i.jsx)("span",{className:"wcso-required",children:"*"})]}),(0,i.jsx)("input",{type:"text",name:"shipping_address_1",value:e.shipping_address_1,onChange:h,className:"wcso-input",placeholder:"House number and street name"})]}),(0,i.jsx)("div",{className:"wcso-form-group",children:(0,i.jsx)("input",{type:"text",name:"shipping_address_2",value:e.shipping_address_2,onChange:h,className:"wcso-input",placeholder:"Apartment, suite, unit, etc. (optional)"})}),(0,i.jsxs)("div",{className:"wcso-form-group",children:[(0,i.jsxs)("label",{children:["Town / City ",(0,i.jsx)("span",{className:"wcso-required",children:"*"})]}),(0,i.jsx)("input",{type:"text",name:"shipping_city",value:e.shipping_city,onChange:h,className:"wcso-input"})]}),(0,i.jsxs)("div",{className:"wcso-grid-2",children:[Object.keys(o).length>0&&(0,i.jsxs)("div",{className:"wcso-form-group",children:[(0,i.jsxs)("label",{children:["State / District ",(0,i.jsx)("span",{className:"wcso-required",children:"*"})]}),(0,i.jsxs)("select",{name:"shipping_state",value:e.shipping_state,onChange:h,className:"wcso-input",children:[(0,i.jsx)("option",{value:"",children:"Select State..."}),Object.entries(o).map(([e,s])=>(0,i.jsx)("option",{value:e,children:s},e))]})]}),(0,i.jsxs)("div",{className:"wcso-form-group",children:[(0,i.jsxs)("label",{children:["Postcode / ZIP ",(0,i.jsx)("span",{className:"wcso-required",children:"*"})]}),(0,i.jsx)("input",{type:"text",name:"shipping_postcode",value:e.shipping_postcode,onChange:h,className:"wcso-input"})]})]}),(0,i.jsxs)("div",{className:"wcso-grid-2",children:[(0,i.jsxs)("div",{className:"wcso-form-group",children:[(0,i.jsx)("label",{children:"Phone (optional)"}),(0,i.jsx)("input",{type:"text",name:"shipping_phone",value:e.shipping_phone,onChange:h,className:"wcso-input"})]}),(0,i.jsxs)("div",{className:"wcso-form-group",children:[(0,i.jsx)("label",{children:"Email address (optional)"}),(0,i.jsx)("input",{type:"email",name:"shipping_email",value:e.shipping_email,onChange:h,className:"wcso-input",placeholder:"recipient@example.com"})]})]}),(0,i.jsxs)("div",{className:"wcso-form-group",children:[(0,i.jsxs)("label",{children:["Shipping Method ",(0,i.jsx)("span",{className:"wcso-required",children:"*"})]}),(0,i.jsxs)("select",{name:"shipping_method",value:e.shipping_method,onChange:e=>{const s=e.target.value,i=d.find(e=>e.method_id===s);a(i?e=>({...e,shipping_method:s,shipping_method_id:i.method_id,shipping_method_title:i.instance_title,shipping_method_cost:i.instance_cost,shipping_method_instance_id:i.instance_id}):e=>({...e,shipping_method:""}))},className:"wcso-input",children:[0===d.length&&(0,i.jsx)("option",{value:"",children:"No methods available"}),d.map(e=>(0,i.jsxs)("option",{value:e.method_id,children:[e.instance_title," (",e.instance_cost>0?e.instance_cost:"Free",")"]},e.method_id))]})]}),(0,i.jsx)("hr",{className:"wcso-divider",style:{margin:"25px 0",border:"0",borderTop:"1px solid #eee"}}),(0,i.jsxs)("h3",{className:"wcso-section-header",children:[(0,i.jsx)("span",{className:"dashicons dashicons-clipboard"})," Additional Information"]}),(0,i.jsxs)("div",{className:"wcso-form-group",children:[(0,i.jsxs)("label",{children:["Sample Category ",(0,i.jsx)("span",{className:"wcso-required",children:"*"})]}),(0,i.jsxs)("select",{name:"sample_category",value:e.sample_category,onChange:h,className:"wcso-input",children:[(0,i.jsx)("option",{value:"Customer Service",children:"Customer Service"}),(0,i.jsx)("option",{value:"Sales Reps",children:"Sales Reps"}),(0,i.jsx)("option",{value:"Promotions",children:"Promotions"})]})]}),(0,i.jsxs)("div",{className:"wcso-form-group",children:[(0,i.jsx)("label",{children:"Order Note"}),(0,i.jsx)("textarea",{name:"order_note",value:e.order_note,onChange:h,className:"wcso-input",rows:"4",placeholder:"Add any special instructions..."})]})]})},o=()=>{const[e,a]=(0,s.useState)([]),[o,l]=(0,s.useState)(!1),[d,p]=(0,s.useState)(null),[h,m]=(0,s.useState)({billing_user_id:window.wcsoData.currentUserId||"",shipping_first_name:"",shipping_last_name:"",shipping_company:"",shipping_country:window.wcsoData.baseCountry||"US",shipping_address_1:"",shipping_address_2:"",shipping_city:"",shipping_state:window.wcsoData.baseState||"",shipping_postcode:"",shipping_phone:"",shipping_email:"",shipping_method:"",sample_category:"Customer Service",order_note:"",shipping_method_id:"",shipping_method_title:"",shipping_method_cost:"",shipping_method_instance_id:""}),u=e.reduce((e,s)=>e+parseFloat(s.price)*s.quantity,0),x=(s,i)=>{i<1||a(e.map(e=>e.id===s?{...e,quantity:i}:e))};return(0,i.jsxs)("div",{className:"wcso-create-layout",children:[(0,i.jsxs)("div",{className:"wcso-col-left",children:[(0,i.jsx)(n,{onAddProduct:s=>{d&&p(null);const i=e.find(e=>e.id===s.id);i?x(s.id,i.quantity+1):a([...e,{...s,quantity:1}])}}),(0,i.jsx)(c,{formData:h,setFormData:m})]}),(0,i.jsxs)("div",{className:"wcso-col-right",children:[(0,i.jsx)(r,{cartTotal:u}),(0,i.jsx)(t,{cart:e,onUpdateQty:x,onRemove:s=>{a(e.filter(e=>e.id!==s))}}),(0,i.jsx)("button",{className:"button button-primary button-large wcso-submit-btn",onClick:()=>{if(0===e.length)return alert("Please add products.");const s=["shipping_first_name","shipping_last_name","shipping_address_1","shipping_city","shipping_country","shipping_postcode","shipping_method"];for(let e of s)if(!h[e]||""===h[e].trim()){const s=e.replace("shipping_","").replace(/_/g," ");return alert(`Field Required: ${s}`)}const i=window.wcsoData.states[h.shipping_country];if(i&&Object.keys(i).length>0&&!h.shipping_state)return alert("Field Required: State / District");l(!0),p(null);const n=window.wcsoData.tierConfig;let t="Approval: Not Needed";t=u<=15?"Approval: Not Needed (Tier 1 Auto-Approve)":u<=100?`Approval: Needed by ${n.t2.name} (Tier 2)`:`Approval: Needed by ${n.t3.name} (Tier 3)`;const r=window.wcsoData.users.find(e=>e.ID==h.billing_user_id),c=r?`${r.display_name} (${r.user_email})`:"Unknown",o=h.order_note,d=`\n------------\nOrder by: ${c}\nOrder total: ${u.toFixed(2)}\n${t}`,x=o?o+"\n"+d:d,g={action:"wcso_create_order",nonce:window.wcsoData.createOrderNonce,products:JSON.stringify(e),...h,order_note:x,billing_user_id:h.billing_user_id||window.wcsoData.currentUserId};window.jQuery.ajax({url:window.wcsoData.ajaxUrl,type:"POST",data:g,success:e=>{l(!1),e.success?(p(e.data),a([]),m(e=>({...e,shipping_first_name:"",shipping_last_name:"",shipping_company:"",shipping_address_1:"",shipping_address_2:"",shipping_city:"",shipping_postcode:"",shipping_phone:"",shipping_email:"",order_note:""}))):alert("Error: "+(e.data||"Unknown error"))},error:(e,s,i)=>{l(!1),console.error("AJAX Error:",i),alert("System Error: The server rejected the request.")}})},disabled:o,children:o?"Creating...":"Create Sample Order"}),d&&(0,i.jsx)("div",{className:"notice notice-success",style:{marginTop:"15px",padding:"12px",borderLeft:"4px solid #46b450",boxShadow:"0 1px 1px rgba(0,0,0,0.04)",background:"#fff"},children:(0,i.jsxs)("p",{style:{margin:0,fontSize:"14px"},children:[(0,i.jsx)("strong",{children:"✓ Order Created! "}),(0,i.jsxs)("a",{href:d.order_url,target:"_blank",rel:"noreferrer",style:{textDecoration:"none"},children:["View Order #",d.order_id," →"]})]})})]})]})},l=()=>{const[e,a]=(0,s.useState)(window.wcsoData.initialSettings),[n,t]=(0,s.useState)(!1),[r,c]=(0,s.useState)(null),o=(e,s,i)=>{a(a=>({...a,tiers:{...a.tiers,[e]:{...a.tiers[e],[s]:i}}}))},l=(e,s)=>{a(i=>({...i,[e]:s}))};return(0,i.jsxs)("div",{className:"wcso-settings-wrapper",children:[(0,i.jsx)("h2",{children:"Plugin Configuration"}),r&&(0,i.jsx)("div",{className:`wcso-notice ${r.type}`,children:r.text}),(0,i.jsxs)("div",{className:"wcso-card",children:[(0,i.jsx)("h3",{children:"General Options"}),(0,i.jsxs)("div",{className:"wcso-field-row",children:[(0,i.jsx)("label",{children:"Discount Coupon Code"}),(0,i.jsx)("input",{type:"text",value:e.coupon_code,onChange:e=>l("coupon_code",e.target.value),placeholder:"e.g. flat100"}),(0,i.jsx)("small",{children:"The coupon applied to make the order $0.00."})]}),(0,i.jsx)("div",{className:"wcso-field-row",children:(0,i.jsxs)("label",{children:[(0,i.jsx)("input",{type:"checkbox",checked:"yes"===e.barcode_scanner,onChange:e=>l("barcode_scanner",e.target.checked?"yes":"no")}),"Enable Barcode Scanner Mode"]})})]}),(0,i.jsxs)("div",{className:"wcso-card",style:{borderLeft:"4px solid #46b450"},children:[(0,i.jsx)("h3",{children:"Tier 1: Auto-Approval"}),(0,i.jsxs)("div",{className:"wcso-grid-2",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{children:"Label Name"}),(0,i.jsx)("input",{type:"text",value:e.tiers.t1.name,onChange:e=>o("t1","name",e.target.value)})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{children:"Limit ($)"}),(0,i.jsx)("input",{type:"number",value:e.tiers.t1.limit,onChange:e=>o("t1","limit",e.target.value)})]})]})]}),(0,i.jsxs)("div",{className:"wcso-card",style:{borderLeft:"4px solid #f0b849"},children:[(0,i.jsx)("h3",{children:"Tier 2: Manager Approval"}),(0,i.jsxs)("div",{className:"wcso-grid-2",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{children:"Label Name"}),(0,i.jsx)("input",{type:"text",value:e.tiers.t2.name,onChange:e=>o("t2","name",e.target.value)})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{children:"Approver Email"}),(0,i.jsx)("input",{type:"email",value:e.tiers.t2.approver,onChange:e=>o("t2","approver",e.target.value)})]})]})]}),(0,i.jsxs)("div",{className:"wcso-card",style:{borderLeft:"4px solid #d63638"},children:[(0,i.jsx)("h3",{children:"Tier 3: Executive Approval"}),(0,i.jsxs)("div",{className:"wcso-grid-2",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{children:"Label Name"}),(0,i.jsx)("input",{type:"text",value:e.tiers.t3.name,onChange:e=>o("t3","name",e.target.value)})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{children:"Approver Email"}),(0,i.jsx)("input",{type:"email",value:e.tiers.t3.approver,onChange:e=>o("t3","approver",e.target.value)})]})]})]}),(0,i.jsx)("button",{className:"button button-primary button-large",onClick:()=>{t(!0),c(null),window.jQuery.post(window.wcsoData.ajaxUrl,{action:"wcso_save_settings",nonce:window.wcsoData.saveSettingsNonce,settings:e},e=>{t(!1),e.success?(c({type:"success",text:"Settings Saved!"}),setTimeout(()=>c(null),3e3)):c({type:"error",text:"Error saving settings."})})},disabled:n,children:n?"Saving...":"Save Settings"})]})},d=()=>(0,i.jsxs)("div",{children:[(0,i.jsx)("h2",{children:"Analytics"}),(0,i.jsx)("p",{children:"Charts will go here."})]}),p=()=>{const[e,n]=(0,s.useState)("create_order");return(0,i.jsxs)("div",{className:"wcso-app-wrapper",children:[(0,i.jsx)(a,{activeView:e,onChangeView:n}),(0,i.jsx)("div",{className:"wcso-content-area",children:(()=>{switch(e){case"create_order":default:return(0,i.jsx)(o,{});case"settings":return(0,i.jsx)(l,{});case"analytics":return(0,i.jsx)(d,{})}})()})]})};document.addEventListener("DOMContentLoaded",()=>{const s=document.getElementById("wcso-root");s&&(0,e.createRoot)(s).render((0,i.jsx)(p,{}))})})();